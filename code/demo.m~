% Check if data folders exist and create if not
if (~exist('./data','dir'))
    mkdir('./data');
end
if (~exist('./data/frames','dir'))
    mkdir('./data/frames');
end

% Use as an example video
videoPath = 'Data/Cylia_beating_movie.avi';

% Get video data
numFrames = get(VideoReader(videoPath), 'numberOfFrames');
v = VideoReader(videoPath);

for idx = 1:numFrames
    if(mod(idx,20)==1)
        disp(['Extracting frame ' num2str(idx) '/' num2str(N)]);
    end
    
    % Extract frame
    frame = readFrame(v);

    % Save image
    imname = ['ChickenDance_' num2str(idx) '.png'];
    imPath = ['./data/frames/' imname];
    imwrite(frame,imPath);
    
    % Convert to expected format for SIFT
    I = single(rgb2gray(frame)) ;

    % Compute SIFT-features
    [f,d] = vl_sift(I) ;
    
    % Extract relevant information
    numfeats = size(d,2);
    descriptors = d';
    positions = f(1:2,:)';
    scales = f(3,:)';
    orients = f(4,:)';
    
    % Save sift data
    siftPath = ['./data/sift/' num2str(idx)];
    save(siftPath,'descriptors','imname', 'numfeats', 'positions', ...
        'scales', 'orients');
end
