function [ power, f, domFreqs ] = WTAnalysis( data, fs, waveletType )%WTANALYSIS performs frequency analysis using the wavelet-transform.% Input:%   data - 3D array of extracted video data (width x height x frames)%   fs - Sampling frequency of the input data%   waveletType - Specifies which wavelet to use (morl by default)%                 Options: morl, mexh, paul, dog% Output:%   power - Power of resulting continuous wavelet transform%   f - Frequency range%   domFreqs - Dominant frequency per region of interest % See also BATCHANALYSEFOLDER, PERFORMFFT.% Check inputacceptableWavelets = ['morl' 'mexh' 'paul' 'dog'];if nargin < 3    waveletType = 'morl';elseif ~strmatch(waveletType, acceptableWavelets)    error('Input ERROR: Expected wavelet type to be: dog, morl, mexh or paul')end% Reorder dimensionsdata = single(permute(data,[3,1,2]));   % Use single because of memory% Compute scalesscales = [];dt = 1/fs;try    f0 = centfrq(waveletType);    scales = helperCWTTimeFreqVector(1,45,f0,dt,16);catch    s0 = 2*dt;    ds=0.1;    NbSc = fix(log2(size(data,3)*dt/s0)/ds);    scales = s0*2.^((0:NbSc-1)*ds);end% Perform CWT ROI-wisepower = zeros(length(scales), size(data,2), size(data,3));for row = 1:size(data,2)    for col = 1:size(data,3)        cwt_res = cwtft({data(:,row,col), dt},'wavelet',waveletType,'scales',scales);        p = abs(cwt_res.cfs).^2;        power(:, row, col) = mean(p,2);    endendf = cwt_res.frequencies;% Get index of dominant frequencies > 1Hz per ROIvalidFreq = find(f>1 & f<fs/2);f = f(validFreq);power = power(validFreq(:),:,:);[~, domFreqIdx] = max(power);% Get pixel-wise dominant frequenciesdomFreqs = f(domFreqIdx);domFreqs = squeeze(domFreqs);end